(function(){var g;g=function(d,a,b){this.env=d;this.element=d.element;this.selection=this.env.selection;b||this.removeBookmarks(this.element);var d=a||this.selection.getRangeAt(0),a=d.cloneRange(),c=a.startContainer,f=a.startOffset,e;a.collapse(!1);b=this.env.document.createElement("span");b.style.display="none";ice.dom.setHtml(b,"&nbsp;");ice.dom.addClass(b,"iceBookmark iceBookmark_end");b.setAttribute("iceBookmark","end");a.insertNode(b);ice.dom.isChildOf(b,this.element)||this.element.appendChild(b);
a.setStart(c,f);a.collapse(!0);c=this.env.document.createElement("span");c.style.display="none";ice.dom.addClass(c,"iceBookmark iceBookmark_start");ice.dom.setHtml(c,"&nbsp;");c.setAttribute("iceBookmark","start");try{a.insertNode(c),c.previousSibling===b&&(e=c,c=b,b=e)}catch(g){ice.dom.insertBefore(b,c)}!1===ice.dom.isChildOf(c,this.element)&&(this.element.firstChild?ice.dom.insertBefore(this.element.firstChild,c):this.element.appendChild(c));b.previousSibling||(e=this.env.document.createTextNode(""),
ice.dom.insertBefore(b,e));c.nextSibling||(e=this.env.document.createTextNode(""),ice.dom.insertAfter(c,e));d.setStart(c.nextSibling,0);d.setEnd(b.previousSibling,b.previousSibling.length||0);this.start=c;this.end=b};g.prototype={selectBookmark:function(){var d=this.selection.getRangeAt(0),a=null,b=null,c=0,f=null,e=this.start&&this.start.parentNode;this.start.nextSibling===this.end||0===ice.dom.getElementsBetween(this.start,this.end).length?this.end.nextSibling?a=ice.dom.getFirstChild(this.end.nextSibling):
this.start.previousSibling?(a=ice.dom.getFirstChild(this.start.previousSibling),a.nodeType===ice.dom.TEXT_NODE&&(c=a.length)):(this.end.parentNode.appendChild(this.env.document.createTextNode("")),a=ice.dom.getFirstChild(this.end.nextSibling)):(this.start.nextSibling?a=ice.dom.getFirstChild(this.start.nextSibling):(this.start.previousSibling||(a=this.env.document.createTextNode(""),ice.dom.insertBefore(this.start,a)),a=ice.dom.getLastChild(this.start.previousSibling),c=a.length),this.end.previousSibling)?
b=ice.dom.getLastChild(this.end.previousSibling):(b=ice.dom.getFirstChild(this.end.nextSibling||this.end),f=0);ice.dom.remove([this.start,this.end]);try{ice.dom.normalize(e)}catch(g){}null===b?(d.setEnd(a,c),d.collapse(!1)):(d.setStart(a,c),null===f&&(f=b.length||0),d.setEnd(b,f));try{this.selection.addRange(d)}catch(h){}},getBookmark:function(d,a){return ice.dom.getClass("iceBookmark_"+a,d)[0]},removeBookmarks:function(d){ice.dom.remove(ice.dom.getClass("iceBookmark",d,"span"))}};this.Bookmark=g}).call(this.ice);